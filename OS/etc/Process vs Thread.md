# 프로세스 vs 스레드
빠지지 않는 단골질문 !


## You can answer
- 프로그램, 프로세스와 스레드의 정의에 대해 말씀해주세요.
- 프로세스와 스레드의 차이는 뭔가요?
- 프로세스와 스레드의 구조, 접근 영역을 설명해주시오



# 프로그램, 프로세스, 스레드가 뭐야?

---

> 프로세스 : 운영체제로부터 자원을 할당 받은 작업의 단위.

> 스레드 : 프로세스가 할당받은 자원을 이용하는 실행 흐름의 단위.
    
    
# 프로그램 → 프로세스 → 스레드

---

## 프로그램 → 프로세스

> 프로그램이란, 파일이 저장 장치에 저장되어 있지만 메모리에는 올라가 있지 않은 정적인 상태를 말한다.

쉽게 말하면, 아직 운영체제가 프로그램에게 독립적인 메모리 공간을 할당해주지 않았고, 실행되지 않고 가만히 있다는 뜻이다! 즉, 실행되지 않은 파일 그 자체를 가리키는 말이다. 그렇다면 프로그램을 실행하면 어떻게 될까? 그 순간 해당 파일은 컴퓨터 메모리에 올라가게 되고, 이 상태의 프로그램을 바!로! 프로세스라고 한다. 


프로세스란

- 컴퓨터에서 연속적으로 실행되고 있는 프로그램
    - 메모리에 올라와 실행되고 있는 프로그램의 인스턴스를 말한다.

![Process](https://user-images.githubusercontent.com/70083982/115980458-dc6ae500-a5c7-11eb-83ea-4745b535e7ea.jpeg)

위 그림은 프로세스 영역을 표시하는 그림인데, 하나의 프로세스는 크게 4영역, **코드 영역 / 데이터 영역 / 스택 영역 / 힙 영역**으로 구분된다. 또한 프로세스는 각각의 독립된 영역을 할당받고, 다른 프로세스의 영역에 절대 접근할 수 없다. 


> 프로세스란, 프로그램이 실행되어 운영체제로부터 자원을 할당받은 작업의 단위!



    한 줄 요약: 프로그램은 코드 덩어리 파일, 그 프로그램을 실행한 게 프로세스.




## 프로세스 → 스레드


실제로 프로그램을 뜯어보면, 프로세스 하나로만 이루어져 있을까? 아니! 보통 여러 프로세스로 이루어져 있다.

그런데 위에서 프로세스는 서로의 영역에 접근할 수 없다고 했다. 이 과정에서 늘어난 CPU의 부담과 중복된 자원의 비효율성 때문에 프로세스 와는 다른 더 작은 실행 단위 개념이 필요하게 되었고, 이 개념이 바로 **스레드**다.


**스레드의 특성**

- 한 프로세서 내의 주소 공간이나 자원들을 대부분 공유
- 기본적으로 하나의 프로세스가 생성되면 하나의 스레드가 같이 생성되며, 이를 메인 스레드라고 부르며, 스레드를 추가로 생성하지 않는 한 모든 프로그램 코드는 메인 스레드에서 실행된다.
- 하나의 프로세스는 여러 개의 스레드를 가질 수 있으며 이를 멀티 스레드라고 한다.

> 스레드란, 한 프로세스 내에서 동작되는 여러 실행의 흐름으로 프로세스 자원을 공유하면서 일련의 과정을 여러 개를 동시에 실행할 수 있는 것.

![multiThread](https://user-images.githubusercontent.com/70083982/115980469-f0164b80-a5c7-11eb-974c-d95ec9d6cbd4.jpeg)

    멀티스레드의 구조를 보면 다음과 같이 Code, Data, Heap영역을 공유하고 있으며,  Stack만 스레드 별로 가지게 된다. 



# 프로세스와 스레드의 작동 방식에 대한 더 자세한 설명

---

## 다시 한번 정리해보자.

![Processes](https://user-images.githubusercontent.com/70083982/115980473-f9071d00-a5c7-11eb-9c40-e527beb37f4e.jpeg)


- 프로세스가 메모리에 올라갈 때 운영체제로부터 시스템 자원을 할당받는다.
- 프로세스마다 각각 독립된 메모리 영역을, Code/Data/Stack/Heap의 형식으로 할당받는다.
- 독립된 메모리 영역이기 때문에 프로세스는 다른 프로세스의 변수나 자료에 접근할 수 없다.

![Thread](https://user-images.githubusercontent.com/70083982/115980477-01f7ee80-a5c8-11eb-9296-2ec4b893e16f.jpeg)


- 프로세스와 다르게 스레드는 메모리를 서로 공유할 수 있다.
- 프로세스가 할당받은 메모리 영역 내에서 Stack 형식으로 할당된 메모리 영역은 따로 할당받고, 나머지 Code/Data/Heap 형식으로 할당된 메모리 영역을 공유한다.
- 따라서 각각의 스레드는 별도의 스택을 가지고 있지만 힙 메모리는 서로 읽고 쓸 수 있게 된다.



## **여기서 프로세스와 스레드의 중요한 차이를 하나 더 알 수 있게 된다.**

- 만약 한 프로세스를 실행 중 오류가 발생, 강제 종료된다면 다른 프로세스들은 영향을 받지 않는다.
- 하지만 스레드의 경우에는  Code/Data/Heap 메모리 영역의 내용을 공유하기 때문에 어떤 스레드 하나에서 오류가 발생한다면 같은 프로세스 내의 다른 스레드 모두가 강제로 종료된다.


코딩을 해 본 경험이 있다면, 코드 내 어떤 함수 하나에서 Segmentation Fault 등의 오류가 발생한 경험이 있을 것이다. 이 오류가 어떤 함수에서 발생했든 간에 해당 코드는 다른 함수 모두에 대한 작업을 중단하고 프로세스 실행을 끝내버린다.



# 멀티태스킹, 멀티스레드는 무엇일까?

---

> 멀티태스킹이 하나의 운영 체제 안에서 여러 프로세스가 실행되는 것이라면, 멀티스레드는 하나의 프로세스가 여러 작업을 여러 스레드를 사용하여 동시에 처리하는 것을 의미한다.


**멀티스레드의 장점**

1. Context-Switching할 때 공유하고 있는 메모리만큼의 메모리 자원을 아낄 수 있다.
2. 스레드는 프로세스 내의 Stack 영역을 제외한 모든 메모리를 공유하기 때문에 통신의 부담이 적어서 응답 시간이 빠르다.


**멀티스레드의 단점**

1. 스레드 하나가 프로세스 내 자원을 망쳐버린다면 모든 프로세스가 종료될 수 있다.
2. 자원을 공유하기 때문에 필연적으로 **동기화 문제**가 발생할 수밖에 없다.


멀티스레드의 장단점에서 꼭 짚고 넘어가야 할 점이 바로 **동기화 문제**다. 

이처럼 여러 스레드가 함께 전역 변수를 사용할 경우 발생할 수 있는 충돌을 동기화 문제라고 한다. 스케줄링은 운영체제가 자동으로 해주지 않기 때문에 프로그래머가 적절한 기법을 직접 구현해야 하므로 프로그래밍할 때 멀티스레드를 사용하려면 신중해야 한다. 디버깅 과정도 까다로워지기 때문이다.

    


